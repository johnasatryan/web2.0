<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Register</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h2>Register</h2>

      <form id="myForm">
        <!-- <label for="name">Full Name</label>
        <input
          type="text"
          name="name"
          id="name"
          placeholder="Enter your name"
        />

        <label for="email">Email</label>
        <input
          type="email"
          name="email"
          id="email"
          placeholder="Enter your email"
        />

        <label for="password">Password</label>
        <input
          type="password"
          name="password"
          id="password"
          placeholder="Enter password"
        /> -->

        <label for="avatar">Profile Photo</label>
        <input type="file" name="avatar" id="avatar" accept="image/*" />

        <button id="btn">Create Account</button>

        <img src="http://localhost:3001/uploads/download.png" />
      </form>
    </div>
    <script>
      // const form = document.getElementById('myForm');
      /*form.addEventListener('submit', (e) => {
        e.preventDefault();

        const fd = new FormData(e.target);

        let data = {};
        for (const [key, value] of fd.entries()) {
          data[key] = value;
        }

        fetch('http://localhost:3001/register', {
          method: 'POST',

          body: fd,
        })
          .then((res) => {
            console.log(res);
          })
          .catch((err) => {
            console.log(err.message);
          });
      }); */

      function toBase64(file) {
        const reader = new FileReader();
        return new Promise((resolve, reject) => {
          reader.onload = () => resolve(reader.result);
          reader.onerror = () => reject(reader.error);

          reader.readAsDataURL(file);
        });
      }

      const btn = document.getElementById('btn');

      btn.addEventListener('click', async (e) => {
        e.preventDefault();
        const image = document.getElementById('avatar').files[0];

        const base64URL = await toBase64(image);

        fetch('http://localhost:3001/register', {
          method: 'POST',
          headers: {
            'content-type': 'application/json',
          },
          body: JSON.stringify({
            filename: image.name,
            type: image.type,
            size: image.size,
            base64URL,
          }),
        }).then((res) => {
          if (res.ok) {
            console.log('OK');
          }
        });
      });
    </script>
  </body>
</html>
